<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI æ™‚å…‰æ©Ÿ V27.0 (Time Machine & Structure Blocks)</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --highlight: #00cec9; /* è½è¦ºé’ */
            --visual: #e17055;    /* è¦–è¦ºæ©˜ */
            --vocal: #fd79a8;     /* äººè²ç²‰ */
            --mandarin: #e84393;  /* è¯èªç´… */
            --japan: #6c5ce7;     /* æ—¥èªç´« */
            --english: #0984e3;   /* è‹±èªè— */
            --param: #74b9ff;     /* åƒæ•¸è— */
            --text: #dfe6e9;
            --border: #333;
            --block-bg: #2d3436;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text); 
            padding: 20px; 
            max-width: 900px; 
            margin: 0 auto; 
            padding-bottom: 400px; /* é ç•™åº•éƒ¨ç©ºé–“ */
        }

        h2 { 
            text-align: center; 
            color: var(--highlight); 
            font-weight: 300; 
            letter-spacing: 2px;
            margin-bottom: 25px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        /* å€å¡Šé€šç”¨ */
        .section-box {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
            transition: all 0.3s;
        }

        .section-box.disabled {
            opacity: 0.4;
            pointer-events: none;
        }
        
        .section-title {
            font-size: 13px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ç¶²æ ¼ç³»çµ± */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .grid-mini {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .choice-btn {
            background: #2d2d2d;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }

        .choice-btn:hover { background: #3d3d3d; }
        
        /* èªè¨€é¡è‰² */
        .btn-lang.active[data-lang="cn"] { background: rgba(232, 67, 147, 0.2); border-color: var(--mandarin); color: var(--mandarin); }
        .btn-lang.active[data-lang="jp"] { background: rgba(108, 92, 231, 0.2); border-color: var(--japan); color: var(--japan); }
        .btn-lang.active[data-lang="en"] { background: rgba(9, 132, 227, 0.2); border-color: var(--english); color: var(--english); }

        /* ä¸€èˆ¬æ¿€æ´» */
        .choice-btn.active { 
            border-color: var(--highlight); 
            background: rgba(0, 206, 201, 0.1); 
            color: var(--highlight);
            font-weight: bold;
        }

        .btn-sub { font-size: 10px; opacity: 0.6; margin-top: 4px; font-weight: normal; }

        /* ğŸ§± çµæ§‹ç©æœ¨æ¨£å¼ (æ–°åŠŸèƒ½) */
        .structure-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .struct-block {
            background: var(--block-bg);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            user-select: none;
            transition: all 0.2s;
        }

        .struct-block:hover { background: #3d3d3d; }

        .struct-block.checked {
            background: rgba(0, 206, 201, 0.15);
            border-color: var(--highlight);
            color: var(--highlight);
        }

        .checkbox-fake {
            width: 12px; height: 12px;
            border: 1px solid #777;
            border-radius: 3px;
            display: inline-block;
            position: relative;
        }

        .struct-block.checked .checkbox-fake {
            background: var(--highlight);
            border-color: var(--highlight);
        }

        /* è¼¸å‡ºå€ */
        .output-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #111;
            border-top: 3px solid var(--highlight);
            padding: 15px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
            z-index: 100;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .output-group { flex: 1; display: flex; flex-direction: column; }
        .output-label { font-size: 11px; color: #777; margin-bottom: 4px; font-weight: bold; text-transform: uppercase; display: flex; justify-content: space-between; }

        textarea {
            width: 100%;
            background: #000;
            border: 1px solid #333;
            color: #fff;
            padding: 8px;
            border-radius: 6px;
            font-family: monospace;
            resize: none;
            box-sizing: border-box; 
            font-size: 11px;
        }
        
        #style-box { height: 45px; color: var(--highlight); }
        #lyrics-box { height: 70px; color: #a29bfe; border-color: #a29bfe; }
        #params-box { height: 35px; color: var(--param); border-color: var(--param); }

        .action-row { display: flex; gap: 10px; margin-top: 5px; }
        .action-btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn-copy { background: var(--highlight); color: #000; }
        .btn-reset { background: #333; color: #fff; flex: 0.3; }

        .tag-pill {
            display: inline-block;
            padding: 2px 6px;
            background: #333;
            border-radius: 4px;
            font-size: 10px;
            margin-right: 4px;
            color: #ccc;
        }

    </style>
</head>
<body>

    <h2>æ™‚å…‰æ©Ÿ <span style="font-size:0.5em; opacity:0.5;">V27.0</span></h2>

    <div class="section-box">
        <div class="section-title"><span>1. é¸æ“‡èªè¨€è»Œé“ (Orbit)</span></div>
        <div class="grid-container" style="grid-template-columns: repeat(3, 1fr);">
            <button class="choice-btn btn-lang" data-lang="cn" onclick="selectLang('cn', this)">
                <span>ğŸ‡¨ğŸ‡³ è¯èª/ç²µèª</span>
                <span class="btn-sub">æƒ…æ„Ÿèˆ‡å›æ†¶</span>
            </button>
            <button class="choice-btn btn-lang" data-lang="jp" onclick="selectLang('jp', this)">
                <span>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</span>
                <span class="btn-sub">æ˜­å’Œè‡³å¹³æˆ</span>
            </button>
            <button class="choice-btn btn-lang" data-lang="en" onclick="selectLang('en', this)">
                <span>ğŸ‡ºğŸ‡¸ English</span>
                <span class="btn-sub">ç¶“å…¸èˆ‡æ–æ»¾</span>
            </button>
        </div>
    </div>

    <div class="section-box disabled" id="section-era">
        <div class="section-title">
            <span>2. é€²å…¥å¹´ä»£ (Time Travel)</span>
            <span id="label-era" style="color:var(--highlight)"></span>
        </div>
        <div class="grid-container" style="grid-template-columns: repeat(4, 1fr);">
            <button class="choice-btn" onclick="selectEra('70s', this)">
                <span>70s</span><span class="btn-sub" id="sub-70s">Vintage</span>
            </button>
            <button class="choice-btn" onclick="selectEra('80s', this)">
                <span>80s</span><span class="btn-sub" id="sub-80s">Retro</span>
            </button>
            <button class="choice-btn" onclick="selectEra('90s', this)">
                <span>90s</span><span class="btn-sub" id="sub-90s">Classic</span>
            </button>
            <button class="choice-btn" onclick="selectEra('00s', this)">
                <span>00s</span><span class="btn-sub" id="sub-00s">Millennium</span>
            </button>
        </div>
    </div>

    <div class="section-box disabled" id="section-vocal" style="border-left: 3px solid var(--vocal);">
        <div class="section-title"><span>3. éˆé­‚é¸è§’ (Vocal Soul)</span></div>
        <div class="grid-mini">
            <button class="choice-btn" onclick="selectGender('male', this)">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ ç”·è² (Male)</span>
                <span class="btn-sub" id="desc-male">--</span>
            </button>
            <button class="choice-btn" onclick="selectGender('female', this)">
                <span>ğŸ™‹ğŸ»â€â™€ï¸ å¥³è² (Female)</span>
                <span class="btn-sub" id="desc-female">--</span>
            </button>
        </div>
    </div>

    <div class="section-box disabled" id="section-struct">
        <div class="section-title">
            <span>4. çµæ§‹ç©æœ¨ (Structure Blocks)</span>
            <span style="font-size:10px; color:#666;">é»æ“Šåˆ‡æ›</span>
        </div>
        <div class="structure-grid" id="struct-container">
            </div>
    </div>

    <div class="output-panel">
        <div class="output-group">
            <div class="output-label">Style (é¢¨æ ¼æŒ‡ä»¤) <span id="logic-log"></span></div>
            <textarea id="style-box" readonly placeholder="ç­‰å¾…è¨­å®š..."></textarea>
        </div>
        <div class="output-group">
            <div class="output-label" style="color: var(--param)">Suno Params (åƒæ•¸å»ºè­°)</div>
            <textarea id="params-box" readonly placeholder="ç­‰å¾…è¨­å®š..."></textarea>
        </div>
        <div class="output-group">
            <div class="output-label">Lyrics & Structure (çµæ§‹)</div>
            <textarea id="lyrics-box" readonly placeholder="[Intro]..."></textarea>
        </div>
        <div class="action-row">
            <button class="action-btn btn-copy" onclick="copyAll()">ğŸ“‹ è¤‡è£½å…¨éƒ¨</button>
            <button class="action-btn btn-reset" onclick="resetAll()">ğŸ”„ é‡ç½®</button>
        </div>
    </div>

    <script>
        // --- ğŸª V27.0 æ ¸å¿ƒè³‡æ–™çŸ©é™£ (The Time Machine Matrix) ---
        const timeMachineData = {
            "cn": {
                "70s": {
                    baseTags: "70s Mandopop, Vintage Recording, Analog Warmth, Mono, Low Fidelity, Tape Hiss, Slow Tempo, Minimalist",
                    forbidden: "Digital, Crisp, Modern, Auto-tune, High Fidelity",
                    params: "Exclude: Modern, Digital | Weirdness: 20% | Influence: 85%",
                    structureDefaults: ["intro", "verse", "chorus", "outro"],
                    blockContent: {
                        intro: "[Intro: Melodic Flute Solo]",
                        verse: "[Verse 1: Sweet Airy Vocals, Very Close Proximity]",
                        chorus: "[Chorus: Gentle Harmony, Sentimental]",
                        bridge: "[Bridge: Acoustic Guitar Solo]",
                        outro: "[Outro: Fade out]"
                    },
                    vocals: {
                        male: { tag: "Warm, Conversational, Folk Style, Witty, Non-operatic", desc: "è¨±å† å‚‘å¼ (é¬¼é¦¬/æº«æš–)" },
                        female: { tag: "Sweet, Airy, Whispery, Crystal Clear, Minimal Vibrato", desc: "é„§éº—å›å¼ (ç”œç¾/æ°£è²)" }
                    }
                },
                "80s": {
                    baseTags: "80s Cantopop, Synth-Pop, Gated Reverb Drums, Analog Synth, Dramatic, Stereo",
                    forbidden: "Acoustic, Dry Mix, Low Fidelity",
                    params: "Exclude: Acoustic, Folk | Weirdness: 30% | Influence: 70%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Synth Hook and Heavy Drums]",
                        verse: "[Verse 1: Reverb Heavy Vocals]",
                        chorus: "[Chorus: Catchy, Romantic]",
                        bridge: "[Bridge: Electric Guitar Solo with Gated Reverb]",
                        outro: "[Outro: Repeat and Fade]"
                    },
                    vocals: {
                        male: { tag: "Romantic, Baritone, Dramatic, Heavy Reverb, Soft Rock", desc: "å¼µåœ‹æ¦®å¼ (æ·±æƒ…/è¯éº—)" },
                        female: { tag: "Contralto, Soulful, Powerful, Melancholic, Stage Presence", desc: "æ¢…è‰·èŠ³å¼ (æ»„æ¡‘/å¤§æ°£)" }
                    }
                },
                "90s": {
                    baseTags: "90s Mandopop, Power Ballad, Orchestral, Piano, Wide Stereo, Multi-layered, Studio Quality",
                    forbidden: "Lo-fi, Mono, Minimalist",
                    params: "Exclude: Rap, Cute, Lofi | Weirdness: 40% | Influence: 60%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Grand Piano and Strings]",
                        verse: "[Verse 1: Deep Emotional Vocals]",
                        chorus: "[Chorus: Powerful Belting, Full Orchestra]",
                        bridge: "[Bridge: Decrescendo, Slowing Down]", // ç…è»Šç³»çµ±
                        outro: "[Outro: Sudden Silence]"
                    },
                    vocals: {
                        male: { tag: "Deep, Resonant, Heavy Vibrato, Belting, Emotional", desc: "å¼µå­¸å‹å¼ (é¡«éŸ³/å¤§æ­Œ)" },
                        female: { tag: "Ethereal, Falsetto, Dream Pop, Celtic influence, Hiccup singing", desc: "ç‹è²å¼ (ç©ºéˆ/æ‹–éŸ³)" }
                    }
                },
                "00s": {
                    baseTags: "00s Mandopop, R&B, Pentatonic Scale, Hip Hop Beat, Piano, Cello, Polished",
                    forbidden: "Vintage, Hiss, Mono",
                    params: "Exclude: EDM, Heavy Metal | Weirdness: 40% | Influence: 60%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Classical Piano Solo]",
                        verse: "[Verse 1: Mumble Rap style, Laid back]",
                        chorus: "[Chorus: R&B Melody with Chinese Instruments]",
                        bridge: "[Bridge: Rap Flow]",
                        outro: "[Outro: Soft Piano]"
                    },
                    vocals: {
                        male: { tag: "Mumble, R&B Flow, Slurred Diction, Cool, Laid-back", desc: "å‘¨æ°å€«å¼ (å«ç³Š/R&B)" },
                        female: { tag: "Youthful, Bright, Pop Sweetness, Straight Tone", desc: "æ¢éœèŒ¹å¼ (æ¸…äº®/æƒ…æ­Œ)" }
                    }
                }
            },
            "jp": {
                "70s": {
                    baseTags: "70s Enka, Kayokyoku, Showa Era, Orchestral, Melodramatic, Vintage Recording",
                    forbidden: "Modern, J-Pop, Electronic",
                    params: "Exclude: Happy, Fast | Weirdness: 30% | Influence: 80%",
                    structureDefaults: ["intro", "verse", "chorus", "outro"],
                    blockContent: {
                        intro: "[Intro: Spoken Word (Deep Emotion)]",
                        verse: "[Verse 1: Melancholic Vocals]",
                        chorus: "[Chorus: Powerful, Dramatic]",
                        bridge: "[Bridge: Saxophone Solo]",
                        outro: "[Outro: Grand Finale]"
                    },
                    vocals: {
                        male: { tag: "Deep Guttural, Kobushi, Melodramatic, Traditional", desc: "æ¼”æ­Œç”·è² (è½‰éŸ³/æ‚²å£¯)" },
                        female: { tag: "Low Register, Melancholic, Serious, Emotional", desc: "å±±å£ç™¾æƒ å¼ (æ˜­å’Œæ†‚æ„)" }
                    }
                },
                "80s": {
                    baseTags: "City Pop, J-Fusion, Slap Bass, Funk, Neon, Urban, 80s J-Pop",
                    forbidden: "Enka, Traditional, Acoustic",
                    params: "Exclude: Sad, Slow | Weirdness: 60% | Influence: 70%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Funky Guitar and Slap Bass]",
                        verse: "[Verse 1: Smooth Vocals]",
                        chorus: "[Chorus: Catchy Melody, Upbeat]",
                        bridge: "[Bridge: Synth Solo]",
                        outro: "[Outro: Fade out]"
                    },
                    vocals: {
                        male: { tag: "Funky, Smooth, English Pronunciation influence, Groovy", desc: "å±±ä¸‹é”éƒå¼ (å¾‹å‹•/æ´‹æ´¾)" },
                        female: { tag: "High Pitch, Bright, Kawaii, Cheerful, Idol Pop", desc: "æ¾ç”°è–å­å¼ (å¶åƒ/ç”œç¾)" }
                    }
                },
                "90s": {
                    baseTags: "90s J-Rock, Visual Kei, Distortion, Double Bass Drum, Fast Tempo, High Energy",
                    forbidden: "Jazz, Lo-fi, Acoustic",
                    params: "Exclude: Pop, Soft | Weirdness: 50% | Influence: 60%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Fast Electric Guitar Riff]",
                        verse: "[Verse 1: Low Voice building up]",
                        chorus: "[Chorus: High Pitch Screaming, Melodic]",
                        bridge: "[Bridge: Twin Guitar Solo]",
                        outro: "[Outro: Feedback Noise]"
                    },
                    vocals: {
                        male: { tag: "Nasal, Dramatic, High Pitch Screaming, Angsty", desc: "è¦–è¦ºç³» (é¼»éŸ³/é«˜éŸ³)" },
                        female: { tag: "Powerful, High Energy, Eurobeat Style, Straightforward", desc: "å®‰å®¤å¥ˆç¾æƒ å¼ (éµè‚º)" }
                    }
                },
                "00s": {
                    baseTags: "00s J-Pop, R&B, Automatic, Groovy, Electronic influence, Polished",
                    forbidden: "Enka, Rock, Traditional",
                    params: "Exclude: Enka | Weirdness: 40% | Influence: 60%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Electronic Beat]",
                        verse: "[Verse 1: R&B Flow]",
                        chorus: "[Chorus: Emotional Melody]",
                        bridge: "[Bridge: English Rap]",
                        outro: "[Outro: Fade out]"
                    },
                    vocals: {
                        male: { tag: "Smooth, R&B, Pop, Light", desc: "å¹³äº•å …å¼ (ç¾è²)" },
                        female: { tag: "Husky, Soulful, R&B, Vibrato", desc: "å®‡å¤šç”°å…‰å¼ (R&B/è½‰éŸ³)" }
                    }
                }
            },
            "en": {
                "70s": {
                    baseTags: "70s Soft Rock, Folk, Acoustic Guitar, Warm, Analog, Vintage",
                    forbidden: "Electronic, Synth, Heavy Metal",
                    params: "Exclude: Digital | Weirdness: 20% | Influence: 80%",
                    structureDefaults: ["intro", "verse", "chorus", "outro"],
                    blockContent: {
                        intro: "[Intro: Acoustic Guitar Fingerpicking]",
                        verse: "[Verse 1: Storytelling Vocals]",
                        chorus: "[Chorus: Warm Harmony]",
                        bridge: "[Bridge: Piano Solo]",
                        outro: "[Outro: Fade out]"
                    },
                    vocals: {
                        male: { tag: "Soft, Gentle, Acoustic Vibe, Storytelling, Warm", desc: "Carpenters/Folk Style" },
                        female: { tag: "Contralto, Warm, Intimate, Velvet Texture, Dry Mix", desc: "Karen Carpenter Style" }
                    }
                },
                "80s": {
                    baseTags: "80s Pop, Synthwave, Drum Machine, Analog Synth, Falsetto, Funky",
                    forbidden: "Acoustic, Country",
                    params: "Exclude: Acoustic | Weirdness: 40% | Influence: 70%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Iconic Synth Riff]",
                        verse: "[Verse 1: Percussive Vocals]",
                        chorus: "[Chorus: High Energy, Danceable]",
                        bridge: "[Bridge: Key Change]",
                        outro: "[Outro: Vocal Ad-libs]"
                    },
                    vocals: {
                        male: { tag: "Falsetto, Hiccups, Percussive Vocals, Funky, High Tenor", desc: "MJ/Prince Style" },
                        female: { tag: "Bright, Reverb Heavy, Pop Diva, Energetic", desc: "Madonna Style" }
                    }
                },
                "90s": {
                    baseTags: "90s Alt Rock, Britpop, Distortion, Jangle Pop, Angsty, Raw",
                    forbidden: "Polished, Auto-tune, Pop",
                    params: "Exclude: Happy, Dance | Weirdness: 60% | Influence: 60%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Distorted Guitar Riff]",
                        verse: "[Verse 1: Mumbled/Low Vocals]",
                        chorus: "[Chorus: Loud, Anthem-like, Distortion]",
                        bridge: "[Bridge: Quiet Section then Explosion]",
                        outro: "[Outro: Feedback and Noise]"
                    },
                    vocals: {
                        male: { tag: "Raspy, Slurred, Angsty, Laid-back, Nasal", desc: "Oasis/Nirvana Style" },
                        female: { tag: "Melismatic, Whistle Register, Powerhouse, Soulful", desc: "Mariah/Diva Style" }
                    }
                },
                "00s": {
                    baseTags: "00s Pop Punk, High Energy, Power Chords, Teenage Angst, Fast Tempo",
                    forbidden: "Slow, Jazz, Acoustic",
                    params: "Exclude: Slow, Sad | Weirdness: 50% | Influence: 70%",
                    structureDefaults: ["intro", "verse", "chorus", "bridge", "outro"],
                    blockContent: {
                        intro: "[Intro: Fast Drum Fill and Guitar]",
                        verse: "[Verse 1: Clean Guitar, Palm Mute]",
                        chorus: "[Chorus: Catchy, High Energy]",
                        bridge: "[Bridge: Half-time breakdown]",
                        outro: "[Outro: Final Chord]"
                    },
                    vocals: {
                        male: { tag: "Nasal, American Accent, Punk Style, High Energy", desc: "Pop Punk Style" },
                        female: { tag: "Sassy, Pop Rock, Attitude, Strong", desc: "Avril Style" }
                    }
                }
            }
        };

        // --- ç‹€æ…‹ç®¡ç† ---
        let currentLang = null;
        let currentEra = null;
        let currentGender = null;
        let currentBlockConfig = {}; // å„²å­˜ç›®å‰çš„ç©æœ¨å…§å®¹

        // --- 1. èªè¨€é¸æ“‡ ---
        function selectLang(lang, btn) {
            currentLang = lang;
            currentEra = null;
            currentGender = null;
            
            // UI æ›´æ–°
            document.querySelectorAll('.btn-lang').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // è§£é–ä¸‹ä¸€é—œ
            const eraSection = document.getElementById('section-era');
            eraSection.classList.remove('disabled');
            document.getElementById('label-era').innerText = "è«‹é¸æ“‡å¹´ä»£...";
            
            // é‡ç½®å¾ŒçºŒ
            document.querySelectorAll('#section-era .choice-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('section-vocal').classList.add('disabled');
            document.getElementById('section-struct').classList.add('disabled');
            resetOutput();
        }

        // --- 2. å¹´ä»£é¸æ“‡ (æ ¸å¿ƒé‚è¼¯ï¼šè¼‰å…¥é è¨­å€¼) ---
        function selectEra(era, btn) {
            currentEra = era;
            currentGender = null;

            // UI æ›´æ–°
            document.querySelectorAll('#section-era .choice-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('label-era').innerText = `${era} (${timeMachineData[currentLang][era].baseTags.split(',')[0]})`;

            // è§£é–äººè²
            document.getElementById('section-vocal').classList.remove('disabled');
            document.querySelectorAll('#section-vocal .choice-btn').forEach(b => b.classList.remove('active'));
            
            // æ›´æ–°äººè²æè¿°æ–‡å­—
            const vocalData = timeMachineData[currentLang][era].vocals;
            document.getElementById('desc-male').innerText = vocalData.male.desc;
            document.getElementById('desc-female').innerText = vocalData.female.desc;

            // ğŸ—ï¸ å»ºæ§‹çµæ§‹ç©æœ¨ (Load Structure Blocks)
            loadStructureBlocks(timeMachineData[currentLang][era]);
            
            // æ›´æ–°åƒæ•¸èˆ‡ Style (æš«æ™‚åªæœ‰åŸºåº•)
            renderOutput();
        }

        // --- 3. äººè²é¸æ“‡ ---
        function selectGender(gender, btn) {
            currentGender = gender;
            document.querySelectorAll('#section-vocal .choice-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderOutput();
        }

        // --- ğŸ—ï¸ çµæ§‹ç©æœ¨ç³»çµ± ---
        function loadStructureBlocks(eraData) {
            const container = document.getElementById('struct-container');
            container.innerHTML = '';
            document.getElementById('section-struct').classList.remove('disabled');
            
            // å®šç¾©æ‰€æœ‰å¯èƒ½çš„ç©æœ¨
            const allBlocks = ['intro', 'verse', 'chorus', 'bridge', 'outro'];
            currentBlockConfig = eraData.blockContent; // å„²å­˜ç•¶å‰å…§å®¹ä¾›æ¸²æŸ“ç”¨

            allBlocks.forEach(blockKey => {
                const div = document.createElement('div');
                div.className = 'struct-block';
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºé è¨­å‹¾é¸
                const isChecked = eraData.structureDefaults.includes(blockKey);
                if(isChecked) div.classList.add('checked');

                div.innerHTML = `
                    <span class="checkbox-fake"></span>
                    <span>${blockKey.charAt(0).toUpperCase() + blockKey.slice(1)}</span>
                `;

                // é»æ“Šäº‹ä»¶ï¼šåˆ‡æ›å‹¾é¸ -> æ›´æ–°æ­Œè©
                div.onclick = () => {
                    div.classList.toggle('checked');
                    renderLyrics();
                };

                container.appendChild(div);
            });
            renderLyrics(); // åˆæ¬¡æ¸²æŸ“æ­Œè©
        }

        // --- æ¸²æŸ“æ­Œè©æ¡† (æ ¹æ“šç©æœ¨ç‹€æ…‹) ---
        function renderLyrics() {
            if (!currentEra) return;
            
            const blocks = document.querySelectorAll('.struct-block');
            let lyricsText = "";

            blocks.forEach(block => {
                if (block.classList.contains('checked')) {
                    const blockName = block.innerText.toLowerCase();
                    // å¾ currentBlockConfig æŠ“å–å°æ‡‰å¹´ä»£çš„æ–‡å­—
                    if (currentBlockConfig[blockName]) {
                        lyricsText += currentBlockConfig[blockName] + "\n\n";
                    }
                }
            });

            document.getElementById('lyrics-box').value = lyricsText.trim();
        }

        // --- æ¸²æŸ“æœ€çµ‚è¼¸å‡º ---
        function renderOutput() {
            if (!currentLang || !currentEra) return;

            const data = timeMachineData[currentLang][currentEra];
            const styleBox = document.getElementById('style-box');
            const paramsBox = document.getElementById('params-box');
            const logSpan = document.getElementById('logic-log');

            // 1. Params
            paramsBox.value = data.params;

            // 2. Style
            let tags = [data.baseTags];
            let logicMsg = "";

            if (currentGender) {
                tags.push(data.vocals[currentGender].tag);
                if (currentGender === 'male') tags.push("Male Vocals");
                else tags.push("Female Vocals");
                logicMsg = `âœ¨ å·²æ³¨å…¥éˆé­‚ï¼š${data.vocals[currentGender].desc}`;
            }

            styleBox.value = tags.join(", ");
            logSpan.innerText = logicMsg;
        }

        function copyAll() {
            const style = document.getElementById('style-box').value;
            const params = document.getElementById('params-box').value;
            const lyrics = document.getElementById('lyrics-box').value;
            
            const textToCopy = `Style:\n${style}\n\nParams:\n${params}\n\nLyrics Structure:\n${lyrics}`;
            
            navigator.clipboard.writeText(textToCopy);
            const btn = document.querySelector('.btn-copy');
            btn.innerText = "âœ… è¤‡è£½æˆåŠŸ";
            setTimeout(() => btn.innerText = "ğŸ“‹ è¤‡è£½å…¨éƒ¨", 2000);
        }

        function resetAll() {
            currentLang = null; currentEra = null; currentGender = null;
            document.querySelectorAll('.active').forEach(b => b.classList.remove('active'));
            document.getElementById('section-era').classList.add('disabled');
            document.getElementById('section-vocal').classList.add('disabled');
            document.getElementById('section-struct').classList.add('disabled');
            document.getElementById('label-era').innerText = "";
            document.getElementById('desc-male').innerText = "--";
            document.getElementById('desc-female').innerText = "--";
            document.getElementById('struct-container').innerHTML = "";
            document.getElementById('logic-log').innerText = "";
            document.getElementById('style-box').value = "";
            document.getElementById('params-box').value = "";
            document.getElementById('lyrics-box').value = "";
        }
    </script>
</body>
</html>